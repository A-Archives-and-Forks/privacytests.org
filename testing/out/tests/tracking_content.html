<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8"/>
    <link rel="shortcut icon" href="#">
  </head>
  <body>
    <script src="./post_data.js"></script>
    <script>
     const tests = [
       {
         name: "Google Tag Manager",
         url: "https://www.googletagmanager.com/gtm.js?id=GTM-NX4SMZL"
       },
       {
         name: "DoubleClick (Google)",
         url: "https://securepubads.g.doubleclick.net/tag/js/gpt.js"
       },
       {
         name: "Google Analytics",
         url: "https://google-analytics.com/ga.js"
       },
       {
         name: "Facebook Pixel",
         url: "https://www.facebook.com/tr?id=123"
       },
       {
         name: "Amazon adsystem",
         url: "https://aax-us-east.amazon-adsystem.com/x/px"
       },
       {
         name: "Google Syndication",
         url: "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",
         //url: "https://tpc.googlesyndication.com/safeframe/1-0-35/html/container.html"
       },
       {
         name: "Scorecard Research Beacon",
         url: "https://sb.scorecardresearch.com/beacon.js"
       },
       {
         name: "New Relic",
         url: "https://js-agent.newrelic.com/nr-1212.min.js"
       },
       {
         name: "Criteo",
         url: "https://csm.da.us.criteo.net/iev",
       },
       {
         name: "Adobe",
         url: "https://munchkin.marketo.net/munchkin.js"
       },
       {
         name: "Yandex Metrika",
         url: "https://mc.yandex.ru/metrika/tag.js"
       },
       {
         name: "AppNext",
         url: "https://acdn.adnxs.com/dmp/up/pixie.js"
       },
       {
         name: "Google Ad Services",
         url: "https://www.googleadservices.com/pagead/conversion.js"
       },
       {
         name: "Twitter Ads",
         url: "https://static.ads-twitter.com/uwt.js"
       },
       {
         name: "Bing Ads",
         url: "https://bat.bing.com/bat.js"
       },
       {
         name: "Taboola",
         url: "https://cdn.taboola.com/libtrc/UNIQUEID/tfa.js"
       },
       {
         name: "Yandex Ads",
         url: "https://yandex.ru/ads/system/header-bidding.js"
       },
       {
         name: "Quantcast",
         url: "https://pixel.quantserve.com/pixel"
       },
       {
         name: "Chartbeat",
         url: "https://pdev.chartbeat.net/ping?h=x&p=x&r=&b=",
       },
       {
         name: "Index Exchange",
         url: "https://js-sec.indexww.com/ht/p/182254-63191772774302.js"
       },
     ];
     const objectToJSON = (obj) => {
       let result = {};
       for (let prop of Object.getOwnPropertyNames(Object.getPrototypeOf(obj))) {
         result[prop] = obj[prop];
       }
       return result;
     };
     const log = (item, passed) => {
       console.log(item, {passed});
       document.body.innerHTML += `<br>${JSON.stringify(objectToJSON(item))}: ${JSON.stringify({passed})}`;
     };
     const testUrl = async (url) => {
       let passed;
       try {
         const response = await fetch(url, {mode:"no-cors", cache:"no-store"});
         passed = !response.ok;
         log(response, passed);
       } catch (err) {
         passed = true;
         log(err, passed);
       }
       return passed;
     };
     const runTest = async () => {
       let results = {};
       for (const {name, url} of tests) {
         const passed = await testUrl(url);
         const description = `Tests whether the browser blocks the page from loading the tracker at ${url}`;
         results[name] = { url, passed, description };
       }
       console.log(results);
       await postDataAndCarryOn(results, "trackers");
     };
     runTest();
    </script>
  </body>
</html>
